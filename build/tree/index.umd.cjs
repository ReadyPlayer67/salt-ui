(function(k,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(k=typeof globalThis<"u"?globalThis:k||self,e(k.index={},k.Vue))})(this,function(k,e){"use strict";const w={data:{type:Object,required:!0},checkable:{type:Boolean,default:!1},operable:{type:Boolean,default:!1},dragdrop:{type:[Boolean,Object],default:!1},height:{type:Number},itemHeight:{type:Number,default:30}};function D(r,o=0,t=[]){return o++,r.reduce((i,a)=>{const d={...a};if(d.level=o,t.length&&(d.parentId=t[t.length-1].id),d.children){const n=D(d.children,o,[...t,d]);return delete d.children,i.concat(d,n)}else return d.isLeaf===void 0&&(d.isLeaf=!0),i.concat(d)},[])}function O(r){const o=e.computed(()=>{let n=[],l=[];for(const c of r.value)n.includes(c)||(c.expanded!==!0&&(n=[...n,...t(c)]),l.push(c));return l}),t=(n,l=!0)=>{let c=[];const x=r.value.findIndex(g=>g.id===n.id);for(let g=x+1;g<r.value.length&&n.level<r.value[g].level;g++)(l||n.level===r.value[g].level-1)&&c.push(r.value[g]);return c};return{expandedTree:o,getChildren:t,getIndex:n=>n?r.value.findIndex(l=>l.id===n.id):-1,getNode:n=>r.value.find(l=>l.id===n.id),getParent:n=>r.value.find(l=>l.id===n.parentId)}}function H(r,o,t,i){return{toggleNode:d=>{const{lazyLoadNodes:n}=i,l=r.value.find(c=>c.id===d.id);l&&(l.expanded=!l.expanded,l.expanded&&n(l))}}}function E(r,o){const{getChildren:t}=o;return{toggleCheckNode:a=>{a.checked=!a.checked,t(a).forEach(c=>{c.checked=a.checked});const d=r.value.find(c=>c.id===a.parentId);if(!d)return;const n=t(d,!1),l=n.filter(c=>c.checked);n.length===l.length?d.checked=!0:d.checked=!1}}}function j(r=8){const o="abcdefghijklmnopqrstuvwxyz0123456789";let t="";for(let i=0;i<r;i++)t+=o[parseInt((Math.random()*o.length).toString())];return t}function B(r,o){const{getChildren:t,getIndex:i}=o;return{append:(n,l)=>{const c=t(n,!1),x=c[c.length-1];let g=i(n)+1;x&&(g=i(x)+1),n.expanded=!0,n.isLeaf=!1;const h=e.ref({...l,level:n.level+1,isLeaf:!0,parentId:n.id});h.value.id===void 0&&(h.value.id=j()),r.value.splice(g,0,h.value)},remove:n=>{const l=t(n).map(c=>c.id);r.value=r.value.filter(c=>c.id!==n.id&&!l.includes(c.id))}}}function R(r,o,{emit:t}){const{getNode:i,getIndex:a,getChildren:d}=o,n=g=>{const h=i(g);h&&h.isLeaf===!1&&!h.childNodeCount&&(h.loading=!0,t("lazy-load",h,l))},l=g=>{const h=i(g.node);if(h){h.loading=!1;const v=e.ref(D(g.treeItems,h.level));c(h,v),x(h,v),h.childNodeCount=d(h).length}},c=(g,h)=>{h.value.forEach(v=>{v.level-1===g.level&&!v.parentId&&(v.parentId=g.id)})},x=(g,h)=>{const v=a(g);v>-1&&r.value.splice(v+1,0,...h.value)};return{lazyLoadNodes:n}}const b={dropPrev:"s-tree__node--drop-prev",dropNext:"s-tree__node--drop-next",dropInner:"s-tree__node--drop-inner"};function $(r,o,{getChildren:t,getParent:i}){const a=e.reactive({dropType:void 0,draggingNode:null,draggingTreeNode:null}),d=e.computed(()=>o.value.reduce((s,u)=>({...s,[u.id]:u}),{})),n=s=>{s==null||s.classList.remove(...Object.values(b))},l=(s,u)=>{var p;const f=(p=d.value[s])==null?void 0:p.parentId;return f===u?!0:f!==void 0?l(f,u):!1},c=()=>{a.dropType=void 0,a.draggingNode=null,a.draggingTreeNode=null},x=(s,u)=>{var f;s.stopPropagation(),a.draggingNode=s.target,a.draggingTreeNode=u,(f=s.dataTransfer)==null||f.setData("dragNodeId",u.id)},g=s=>{if(s.preventDefault(),s.stopPropagation(),!!a.draggingNode&&r){if(s.dataTransfer&&(s.dataTransfer.dropEffect="move"),!o)return;let u={};typeof r=="object"?u=r:r&&(u={dropInner:!0});const{dropPrev:f,dropNext:p,dropInner:N}=u;let y;const T=f?N?.25:p?.45:1:-1,C=p?N?.75:f?.55:0:1,I=s.currentTarget,L=I==null?void 0:I.getBoundingClientRect(),S=s.clientY-((L==null?void 0:L.top)||0);if(S<((L==null?void 0:L.height)||0)*T?y="dropPrev":S>((L==null?void 0:L.height)||0)*C?y="dropNext":N?y="dropInner":y=void 0,y){const _=I==null?void 0:I.classList;_&&(_.contains(b[y])||(n(I),_.add(b[y])))}else n(I);a.dropType=y}},h=s=>{s.stopPropagation(),a.draggingNode&&n(s.currentTarget)},v=(s,u)=>{var p;if(s.preventDefault(),s.stopPropagation(),n(s.currentTarget),!a.draggingNode||!r)return;const f=(p=s.dataTransfer)==null?void 0:p.getData("dragNodeId");if(f){const N=l(u.id,f);if(f===u.id||N)return;a.dropType&&m(f,u),c()}};function m(s,u){const f=o.value.find(p=>p.id===s);if(f){let p;const N=t(f),y=i(f);if(a.dropType==="dropInner"){p={...f,parentId:u.id,level:u.level+1};const T=o.value.indexOf(u);o.value.splice(T+1,0,p),u.isLeaf=void 0;const C=o.value.indexOf(f);o.value.splice(C,1)}else if(a.dropType==="dropNext"){p={...f,parentId:u.parentId,level:u.level};const T=o.value.indexOf(u),C=t(u,!0).length;o.value.splice(T+C+1,0,p);const I=o.value.indexOf(f);o.value.splice(I,1)}else if(a.dropType==="dropPrev"){p={...f,parentId:u.parentId,level:u.level};const T=o.value.indexOf(u);o.value.splice(T,0,p);const C=o.value.indexOf(f);o.value.splice(C,1)}a.dropType="dropInner",N.forEach(T=>m(T.id,p)),y&&t(y).length===0&&(y.isLeaf=!0)}}return{onDragstart:x,onDragover:g,onDragleave:h,onDrop:v,onDragend:s=>{s.preventDefault(),s.stopPropagation(),c()}}}function q(r,o,t){const i=e.ref(D(e.unref(r))),a=O(i),d=[H,E,B],n=R(i,a,t),l=$(o.dragdrop,i,a),c=d.reduce((x,g)=>({...x,...g(i,a,t,n)}),{});return{innerData:i,...a,...l,...c}}const U={...w,treeNode:{type:Object,required:!0}},P=28,M=24,Y=e.defineComponent({name:"STreeNode",props:U,setup(r,{slots:o}){const{treeNode:t,checkable:i,operable:a,dragdrop:d}=e.toRefs(r),{toggleNode:n,toggleCheckNode:l,getChildren:c,append:x,remove:g,onDragstart:h,onDragend:v,onDragleave:m,onDragover:V,onDrop:s}=e.inject("TREE_UTILS"),u=e.ref(!1),f=()=>{u.value=!u.value};let p={};return d&&(p={draggable:!0,onDragstart:N=>h(N,t.value),onDragend:N=>v(N),onDragleave:N=>m(N),onDragover:N=>V(N),onDrop:N=>s(N,t.value)}),()=>e.createVNode("div",{class:"s-tree__node hover:bg-slate-100 relative leading-8",style:{paddingLeft:`${M*(t.value.level-1)}px`},onMouseenter:f,onMouseleave:f},[!t.value.isLeaf&&t.value.expanded&&e.createVNode("span",{class:"s-tree-node_vline absolute w-px bg-gray-300",style:{height:`${P*c(t.value).length}px`,left:`${M*(t.value.level-1)+12}px`,top:`${P}px`}},null),e.createVNode("div",e.mergeProps({class:"s-node__node-content"},p),[t.value.isLeaf?e.createVNode("span",{style:{display:"inline-block",width:"25px"}},null):o.icon(),i.value&&e.createVNode("span",{class:`relative ${t.value.checked?"s-tree__inChecked":""}`},[e.withDirectives(e.createVNode("input",{type:"checkbox",style:{marginRight:"8px"},"onUpdate:modelValue":N=>t.value.checked=N,onClick:()=>l(t.value)},null),[[e.vModelCheckbox,t.value.checked]])]),o.content(),a.value&&u.value&&e.createVNode("span",{class:"inline-flex ml-1"},[e.createVNode("svg",{onClick:()=>{x(t.value,{label:"\u65B0\u8282\u70B9"})},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer"},[e.createVNode("path",{d:"M590.769231 571.076923h324.923077c15.753846 0 29.538462-13.784615 29.538461-29.538461v-59.076924c0-15.753846-13.784615-29.538462-29.538461-29.538461H590.769231c-11.815385 0-19.692308-7.876923-19.692308-19.692308V108.307692c0-15.753846-13.784615-29.538462-29.538461-29.538461h-59.076924c-15.753846 0-29.538462 13.784615-29.538461 29.538461V433.230769c0 11.815385-7.876923 19.692308-19.692308 19.692308H108.307692c-15.753846 0-29.538462 13.784615-29.538461 29.538461v59.076924c0 15.753846 13.784615 29.538462 29.538461 29.538461H433.230769c11.815385 0 19.692308 7.876923 19.692308 19.692308v324.923077c0 15.753846 13.784615 29.538462 29.538461 29.538461h59.076924c15.753846 0 29.538462-13.784615 29.538461-29.538461V590.769231c0-11.815385 7.876923-19.692308 19.692308-19.692308z"},null)]),e.createVNode("svg",{onClick:()=>{g(t.value)},viewBox:"0 0 1024 1024",width:"14",height:"14",class:"cursor-pointer ml-1"},[e.createVNode("path",{d:"M610.461538 500.184615l256-257.96923c11.815385-11.815385 11.815385-29.538462 0-41.353847l-39.384615-41.353846c-11.815385-11.815385-29.538462-11.815385-41.353846 0L527.753846 417.476923c-7.876923 7.876923-19.692308 7.876923-27.569231 0L242.215385 157.538462c-11.815385-11.815385-29.538462-11.815385-41.353847 0l-41.353846 41.353846c-11.815385 11.815385-11.815385 29.538462 0 41.353846l257.969231 257.969231c7.876923 7.876923 7.876923 19.692308 0 27.56923L157.538462 785.723077c-11.815385 11.815385-11.815385 29.538462 0 41.353846l41.353846 41.353846c11.815385 11.815385 29.538462 11.815385 41.353846 0L498.215385 610.461538c7.876923-7.876923 19.692308-7.876923 27.56923 0l257.969231 257.969231c11.815385 11.815385 29.538462 11.815385 41.353846 0L866.461538 827.076923c11.815385-11.815385 11.815385-29.538462 0-41.353846L610.461538 527.753846c-7.876923-7.876923-7.876923-19.692308 0-27.569231z"},null)])]),t.value.loading&&o.loading()])])}}),A=e.defineComponent({props:{expanded:{type:Boolean,required:!0}},emits:["click"],setup(r,{emit:o}){return()=>e.createVNode("svg",{onClick:()=>o("click"),style:{width:"25px",height:"15px",display:"inline-block",cursor:"pointer",transform:r.expanded?"rotate(90deg)":""},viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg"},[e.createVNode("path",{fill:"currentColor",d:"M384 192v640l384-320.064z"},null)])}}),G={data:{type:Array,required:!0},itemHeight:{type:Number,default:24},component:{type:String,default:"div"}},F=e.defineComponent({name:"SVirtualList",props:G,setup:function(r,{slots:o}){const{data:t,itemHeight:i,component:a}=e.toRefs(r),d=e.ref(),n=e.ref(0),l=e.ref(0),c=e.computed(()=>Math.ceil(n.value/i.value)),x=e.computed(()=>t.value.slice(l.value,Math.min(l.value+c.value,t.value.length)));e.onMounted(()=>{n.value=d.value.clientHeight});const g=e.ref(0),h=v=>{const{scrollTop:m}=v.target;l.value=Math.floor(m/i.value),g.value=m-m%i.value};return()=>e.createVNode("div",{class:"s-virtual-list__container",ref:d,onScroll:h},[e.createVNode("div",{class:"s-virtual-list__blank",style:{height:`${t.value.length*i.value}px`}},null),e.createVNode("div",{class:"s-virtual-list",style:{transform:`translate3d(0,${g.value}px,0)`}},[x.value.map((v,m)=>{var V;return(V=o.default)==null?void 0:V.call(o,{item:v,index:m})})])])}}),z=e.defineComponent({name:"STree",props:w,emits:["lazy-load"],setup(r,o){const{data:t,height:i,itemHeight:a}=e.toRefs(r),{slots:d}=o,{expandedTree:n,toggleNode:l,getChildren:c,toggleCheckNode:x,append:g,remove:h,onDragstart:v,onDragend:m,onDragleave:V,onDragover:s,onDrop:u}=q(t,r,o);return e.provide("TREE_UTILS",{toggleNode:l,getChildren:c,toggleCheckNode:x,append:g,remove:h,onDragstart:v,onDragend:m,onDragleave:V,onDragover:s,onDrop:u}),()=>{const f=p=>e.createVNode(Y,e.mergeProps(r,{treeNode:p}),{content:()=>d.content?d.content(p):p.label,icon:()=>d.icon?d.icon({nodeData:p,toggleNode:l}):e.createVNode(A,{expanded:!!p.expanded,onClick:()=>{l(p)}},null),loading:()=>d.loading?d.loading({nodeData:p}):e.createVNode("span",{class:"ml-1"},[e.createVNode("svg",{class:"rotating-icon",height:"16",width:"16",viewBox:"0 0 1024 1024",xmlns:"http://www.w3.org/2000/svg",style:"display:inline-block"},[e.createVNode("path",{fill:"currentColor",d:"M512 64a32 32 0 0 1 32 32v192a32 32 0 0 1-64 0V96a32 32 0 0 1 32-32zm0 640a32 32 0 0 1 32 32v192a32 32 0 1 1-64 0V736a32 32 0 0 1 32-32zm448-192a32 32 0 0 1-32 32H736a32 32 0 1 1 0-64h192a32 32 0 0 1 32 32zm-640 0a32 32 0 0 1-32 32H96a32 32 0 0 1 0-64h192a32 32 0 0 1 32 32zM195.2 195.2a32 32 0 0 1 45.248 0L376.32 331.008a32 32 0 0 1-45.248 45.248L195.2 240.448a32 32 0 0 1 0-45.248zm452.544 452.544a32 32 0 0 1 45.248 0L828.8 783.552a32 32 0 0 1-45.248 45.248L647.744 692.992a32 32 0 0 1 0-45.248zM828.8 195.264a32 32 0 0 1 0 45.184L692.992 376.32a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0zm-452.544 452.48a32 32 0 0 1 0 45.248L240.448 828.8a32 32 0 0 1-45.248-45.248l135.808-135.808a32 32 0 0 1 45.248 0z"},null)])])});return e.createVNode("div",{class:"s-tree"},[i!=null&&i.value?e.createVNode("div",{style:{height:`${i.value}px`}},[e.createVNode(F,{data:n.value,itemHeight:a.value},{default:({item:p})=>f(p)})]):n.value.map(p=>f(p))])}}}),J={install(r){r.component("STree",z)}};k.Tree=z,k.default=J,Object.defineProperties(k,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
